## 최신 업데이트 (2026-01-31)

### Contour Extractor v3 - Canny Edge 기반 그림-텍스트 쌍 추출

- **목표:** 독일어 단어장 이미지에서 그림-텍스트 쌍을 자동 추출하여 Flashcard 생성
- **문제:** 기존 FastSAM 기반 추출기는 83개 객체를 감지했으나 실제 그림은 ~18개
- **해결책:** Canny Edge Detection 기반으로 전환하여 정확도 향상

### 핵심 변경사항

1. **Canny Edge 기반 영역 감지**
   - `cv2.Canny(gray, 30, 100)` 에지 검출
   - 모폴로지 연산으로 영역 연결 및 채우기
   - 면적/종횡비 기반 그림vs텍스트 분류

2. **분류 기준**
   - 그림: 면적 비율 ≥ 0.18%, 종횡비 0.5~2.0
   - 텍스트: 그 외 영역

3. **테스트 결과 (10개 이미지)**
   - 103837, 103840: **18쌍** (목표 달성)
   - 대부분 이미지: 15~17쌍
   - 103909, 103918: 2~4쌍 (빈 페이지)
   - **총 138쌍 추출 성공**

4. **출력 파일**
   - `output_pairs/pairs_*.json`: 쌍 데이터 (좌표, OCR 결과)
   - `output_pairs/vis_*.jpg`: 시각화 이미지

### 실행 커맨드
```powershell
python contour_extractor_v3.py all
```

### 알려진 한계점
- OCR (EasyOCR)이 독일어 텍스트를 부정확하게 인식
- 텍스트는 수동 입력 또는 별도 OCR 개선 필요

---

## [History] 오늘 진행한 작업 요약 (2026-01-24)

- **목표:** 로컬 CLI 기반 Flashcard 자료 생산 엔진(MVP v0.1) 통합 테스트 및 튜닝, 출력 계약(이미지 + result.json + review_queue.json + metrics.json + errors.jsonl) 검증

- **환경:** Windows, Python 3.11 가상환경(`.venv`) — PaddleOCR 안정 동작을 위해 Python 3.11 사용 권장

- **주요 의사결정/변경사항**
  - PaddleOCR 동작 안정화를 위해 `paddlepaddle==2.6.2`, `paddleocr<3`, `pillow==10.4.0` 설치
  - `segmenter` 관련 버그 수정: 중복/정의되지 않은 지역변수 제거 및 `run_single_word` 재구성
  - `--segmenter off` 옵션이 실제로 분절 단계를 비활성화하도록 `pipeline.py`/`segmenter.py` 수정
  - PaddleOCR 내부 로그 억제를 위해 `ocr.py`에서 `show_log=False` 설정
  - 설정 튜닝: `config/default.json`에서 `segment.expand_scale=5.0`, `segment.min_area_ratio=0.01`

- **생성된 작업(Job) 샘플**
  - STEP1 (segmenter off): `workspace/jobs/ad594bc7-b0b8-46c2-848e-ce7cb71b51d1/`
  - STEP2 (mobilesam, 튜닝 적용): `workspace/jobs/31c698ca-cba9-4c4d-bf14-ee66b3a6a42a/`

- **간단 실행 커맨드 예시**
  ```powershell
  .\.venv\Scripts\python -m flashcard_engine.cli run --input .\Images --type images --lang en --workspace .\workspace --source "ImagesTest" --min-confidence 0.7 --segmenter off --segmenter-device cpu --config .\config\default.json
  ```

- **다음 권장 작업**
  - `samples/book.pdf` 업로드 후 PDF 파이프라인(STEP 3) 실행 및 검증
  - segmenter 모델(또는 MobileSAM) 실제 설치/연동 테스트 (현재는 bbox_fallback 사용)
  - 출력 품질 향상을 위한 OCR 사전처리·후처리 규칙 추가
